<?php
/**
 * Created by PhpStorm.
 * User: 2m
 * Date: 2016/11/10
 * Time: 下午4:36
 */

namespace app\filters;

use yii\base\ActionFilter;

class PrivilegeFilter extends ActionFilter
{
    public $prvi;

    public function beforeAction($action)
    {
        parent::beforeAction($action); // TODO: Change the autogenerated stub

        if(is_array($this->prvi))
        {
            $id = $action->id;

            foreach($this->prvi as $id_ => $prvi)
            {
                if($id_ == $id)
                {
                    if(!($flag = \Yii::$app->privilege->has($prvi)))
                    {
                        \Yii::$app->response->format = 'json';
                        \Yii::$app->response->data = ['status' => 0,'message' => 'Forbidden'];
                    }
                    return $flag;
                }
            }
        }else{
            if(!($flag = \Yii::$app->privilege->has($this->prvi)))
            {
                \Yii::$app->response->format = 'json';
                \Yii::$app->response->data = ['status' => 0,'message' => 'Forbidden'];
            }
            return $flag;
        }
    }
}